---
layout: post
title: magicblog开发日记(1)-修改设置，增加静态页面，完成基本model
category: essay
---

开发环境为linux，编辑器用vim，服务器用Apache，数据库用mysql

linux自带python，django的安装见官网，相关软件的安装请google，windows用户也请自己google。这些内容网上都有，我就不累述了。

下面开始干活：

首先 django-admin.py startproject magicblog 创建一个project，之后 python  manage.py runserver， 现在打开<a href="http://127.0.0.1:8000/">http://127.0.0.1:8000/</a>，显示的是默认页面

在主目录下创建templates目录，在其内加入创建base.html和about.html文件，添加一些html代码

编辑settings.py来进行一些设置：

由于settings.py中的路径必须为绝对路径，不方便移植，首先在文件头部添加以下lambda函数：

import os
rel = lambda *x: os.path.join(os.path.abspath(os.path.dirname(__file__)), *x)

之后就可以通过rel()函数将相对路径转化为绝对路径了

对于DATABASES进行设置(除了mysql你也可以选择其他数据库，没有任何影响)

TIME_ZONE设置为Asia/Shanghai

在TEMPLATE_DIRS中添加"rel(‘templates’)"

首先处理静态页面

在根目录下创建views.py文件，添加如下类：
[code]
from django.shortcuts import render_to_response
def static_page(response, template):
     template = &quot;%s.html&quot; % (template)
     return render_to_response(template)
[/code]
在编辑urls.py文件如下：
[code]
#the import
from mysite.views import *
#the urlconf
urlpatterns = patterns('',
...
(r'^$', static_page, {'template': 'base'}),
(r'^(?P&amp;amp;lt;template&amp;amp;gt;\w+)/$', static_page),
)
[/code]
之后再打开<a href="http://127.0.0.1:8000/">http://127.0.0.1:8000/</a>就可以看到你在base.html中写的内容了，打开<a href="http://127.0.0.1:8000/">http://127.0.0.1:8000</a>/about就可以看到about.html了

好了，下面开始搞model了。先 manage.py startapp blog 新建一个名为‘blog’的app。

编辑models.py文件：
[code]
from django.db import models

from django.contrib.auth.models import User

from datetime import datetime

class Category(models.Model):
     name = models.CharField(max_length=50)

     def __unicode__(self):
          return self.name

class Tag(models.Model):
     name = models.CharField(max_length=50)

     def __unicode__(self):
          return self.name

class Post(models.Model):
     author = models.ForeignKey(User, related_name='posts')
     title = models.CharField(max_length=100)
     slug = models.SlugField(max_length=100, unique=True)
     body = models.TextField()
     excerpt = models.TextField()
     published = models.BooleanField(default=False)
     pub_date = models.DateTimeField(&quot;Date Published&quot;, auto_now_add=True)
     up_date = models.DateTimeField(&quot;Date Updated&quot;, auto_now=True)
     categories = models.ManyToManyField(Category)
     tags = models.ManyToManyField(Tag)

     def __unicode__(self):
          return self.title
[/code]
上面的代码非常简单，就不解释了
然后再blog目录下创建一个admin.py文件，如下：
[code]
from django.contrib import admin
from magicblog.blog.models import *

class PostAdmin(admin.ModelAdmin):
     filter_horizontal = (&quot;categories&quot;, &quot;tags&quot;, )
     list_display = (&quot;title&quot;, &quot;published&quot;, &quot;pub_date&quot;)
     date_hierarchy = 'pub_date'
     prepopulated_fields = {&quot;slug&quot; : (&quot;title&quot;,)}

     def save_model(self, request, obj, form, change):
          if not change:
               obj.author=request.user
          obj.save()

admin.site.register(Category)
admin.site.register(Tag)
admin.site.register(Post, PostAdmin)
[/code]
上面的代码对Django的admin进行了一些设置，用于后台页面，也很容易理解。
在settings.py中要将'django.contrib.admin'取消注释，以便admin起作用。
最后执行以下 python manage.py syncdb 搞定数据库，现在就可以到http://127.0.0.1:8000/admin 去看一看了，你可以增加几个tag，category和post了

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

第一天的工作就到这了，明天再加上基本的template就算是一个简单的blog了！

下图是今天完成之后“添加文章”的效果图，还不错，Django很好很强大
<p style="text-align: center;"><img class="aligncenter" title="magicblog1-1" src="https://uk1xdq.blu.livefilestore.com/y1pzdCwqIYWotoBPf_yIwvqIY13kowLukkvLj7t3G1IdnKcuf9zJcjEsZEdasdVQf0wJxSEDUnFNJdol0XFbP4WhUvALxSoVOBa/magicblog1-1.png?psid=1" alt="" width="624" height="468" /><img class="aligncenter" title="magicblog1-2" src="https://uk1xdq.blu.livefilestore.com/y1pmSxK7rn9VwH_IgBRHPTZtl_Lt64ipP-9P-P6XCHA5dYZg3T6NA8-7_RgjQTu_BLLXJ40mrYrm01VSsbJ8szenWl5CaCAi1Hk/magicblod1-2.png?psid=1" alt="" width="624" height="468" /></p>